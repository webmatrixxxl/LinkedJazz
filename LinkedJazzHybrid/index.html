<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />

    <link href="http://cdn.kendostatic.com/2013.1.319/styles/kendo.common.min.css" rel="stylesheet" type="text/css" />
    <link href="http://cdn.kendostatic.com/2013.1.319/styles/kendo.rtl.min.css" rel="stylesheet" type="text/css" />
    <link href="http://cdn.kendostatic.com/2013.1.319/styles/kendo.default.min.css" rel="stylesheet" type="text/css" />
    <link href="http://cdn.kendostatic.com/2013.1.319/styles/kendo.dataviz.min.css" rel="stylesheet" type="text/css" />
    <link href="http://cdn.kendostatic.com/2013.1.319/styles/kendo.dataviz.default.min.css" rel="stylesheet" type="text/css" />
    <link href="http://cdn.kendostatic.com/2013.1.319/styles/kendo.mobile.all.min.css" rel="stylesheet" type="text/css" />

        <link href="styles/app.css" rel="stylesheet" />

            <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://cdn.kendostatic.com/2013.1.319/js/kendo.all.min.js"></script>


    <script src="cordova.js"></script>

    <script src="scripts/libs/rsvp.min.js"></script>
    <script src="scripts/app/http-request.js"></script>
    <script src="scripts/app/extensions.js"></script>
    <script src="scripts/app/categories.js"></script>
    <script src="scripts/app/places.js"></script>
    <script src="scripts/app.js"></script>





    <script src="Linked%20Jazz_files/jquery.rdfquery.core.min-1.0.js" type="text/javascript"></script>

    <script src="Linked%20Jazz_files/d3.js" type="text/javascript"></script>




    <script>


        if (!document.createElementNS || !document.createElementNS('http://www.w3.org/2000/svg', 'svg').createSVGRect) {
            alert('We\'re Sorry, this visualization uses the SVG standard, most modern browsers support SVG. If you would like to see this visualization please view this page in another browser such as Google Chrome, Firefox, Safari, or Internet Explorer 9+');
        }

        var fileNames = ['Jackie_McLean.png', 'Coleman_Hawkins.png', 'Barney_Bigard.png', 'Woody_Herman.png', 'Ray_Drummond.png', 'Sy_Oliver.png', 'Billy_Taylor_(jazz_bassist).png', 'Stan_Kenton.png', 'Buddy_Rich.png', 'Lee_Young.png', 'Frank_Wess.png', 'Miles_Davis.png', 'Jimmie_Lunceford.png', 'Stevie_Wonder.png', 'Oscar_Peterson.png', 'Etta_Jones.png', 'Earl_Hines.png', 'Herbie_Hancock.png', 'Julius_Watkins.png', 'Jerome_Richardson.png', 'Art_Blakey.png', 'Buster_Williams.png', 'Wynton_Marsalis.png', 'Charlie_Johnson_(bandleader).png', 'Lucky_Millinder.png', 'John_Levy_(musician).png', 'Cab_Calloway.png', 'Chu_Berry.png', 'Freddie_Green.png', 'Artie_Shaw.png', 'Jimmy_Dorsey.png', 'Sammy_Davis,_Jr..png', 'Joe_King_Oliver.png', 'Philly_Joe_Jones.png', 'Slide_Hampton.png', 'Jo_Jones.png', 'Fats_Navarro.png', 'Tony_Williams.png', 'Danny_Barker.png', 'Bill_Johnson_(reed_player).png', 'Tadd_Dameron.png', 'Charlie_Parker.png', 'Thelonious_Monk.png', 'Marian_McPartland.png', 'Mel_Lewis.png', 'Sweets_Edison.png', 'Eric_Dolphy.png', 'Kid_Ory.png', 'John_Lewis_(pianist).png', 'Jimmy_Jones_(pianist).png', 'Helen_Humes.png', 'Ron_Carter.png', 'Erroll_Garner.png', 'James_Moody_(saxophonist).png', 'Teddy_Wilson.png', 'Sam_Rivers.png', 'Sarah_Vaughan.png', 'Red_Rodney.png', 'Tommy_Dorsey.png', 'Gigi_Gryce.png', 'Tony_Bennett.png', 'Billie_Holiday.png', 'Harold_Ousley.png', 'Gerald_Wiggins.png', 'Billy_Strayhorn.png', 'Tiny_Bradshaw.png', 'Jimmy_Scott.png', 'Max_Roach.png', 'Wayne_Shorter.png', 'Yusef_Lateef.png', 'Paul_Gonsalves.png', 'Harry_James.png', 'Shadow_Wilson.png', 'Tommy_Potter.png', 'Bill_Evans.png', 'Fats_Domino.png', 'George_Wein.png', 'Clark_Terry.png', 'Lionel_Hampton.png', 'Benny_Waters.png', 'Hank_Jones.png', 'Buddy_Tate_(musician).png', 'Illinois_Jacquet.png', 'Carmen_McRae.png', 'Eddie_Marshall.png', 'Lucky_Thompson.png', 'Phil_Woods.png', 'Phil_Wilson_(trombonist).png', 'Joe_Williams_(jazz_singer).png', 'Lena_Horne.png', 'Louie_Bellson.png', 'Lawrence_Brown_(musician).png', 'Billy_Higgins.png', 'Bob_Haggart.png', 'Jack_Teagarden.png', 'Gene_Krupa.png', 'Ornette_Coleman.png', 'Oscar_Pettiford.png', 'Count_Basie.png', 'Charlie_Shavers.png', 'John_Coltrane.png', 'Thad_Jones.png', 'Art_Farmer.png', 'Benny_Golson.png', 'Fletcher_Henderson.png', 'Erskine_Hawkins.png', 'Buddy_DeFranco.png', 'Roy_Eldridge.png', 'Milt_Hinton.png', 'Ray_Nance.png', 'Elvin_Jones.png', 'Budd_Johnson.png', 'Ben_Webster.png', 'Al_McKibbon.png', 'Frank_Foster_(musician).png', 'Ella_Fitzgerald.png', 'Gil_Evans.png', 'Andy_Kirk.png', 'Joe_Newman_(trumpeter).png', 'Fats_Waller.png', 'Milt_Jackson.png', 'Roy_Haynes.png', 'Sonny_Stitt.png', 'Bud_Powell.png', 'Benny_Powell.png', 'Oliver_Nelson.png', 'Mary_Lou_Williams.png', 'Quincy_Jones.png', 'Billy_Eckstine.png', 'Delfeayo_Marsalis.png', 'Don_Redman.png', 'Benny_Carter.png', 'Chet_Baker.png', 'Dave_Brubeck.png', 'Johnny_Griffin.png', 'Nat_Pierce.png', 'Dizzy_Gillespie.png', 'Dinah_Washington.png', 'Betty_Carter.png', 'Stan_Getz.png', 'J._J._Johnson.png', 'Gunther_Schuller.png', 'Percy_Heath.png', 'Tricky_Sam_Nanton.png', 'Cozy_Cole.png', 'Kenny_Clarke.png', 'Johnny_Hodges.png', 'Ed_Shaughnessy.png', 'Sid_Catlett.png', 'Jane_Jarvis.png', 'Neal_Hefti.png', 'Randy_Weston.png', 'Frank_Sinatra.png', 'Herb_Jeffries.png', 'McCoy_Tyner.png', 'Sidney_Bechet.png', 'Willie_The_Lion_Smith.png', 'Art_Tatum.png', 'Don_Byas.png', 'Joe_Morello.png', 'Sonny_Greer.png', 'Benny_Goodman.png', 'Charles_Mingus.png', 'Chico_Hamilton.png', 'Ray_Brown,_Jr..png', 'Norman_Granz.png', 'Babs_Gonzales.png', 'Doc_Cheatham.png', 'Kaiser_Marshall.png', 'Nat_King_Cole.png', 'Buck_Clayton.png', 'Jay_McShann.png', 'Bennie_Moten.png', 'Chick_Webb.png', 'Louis_Jordan.png', 'Nancy_Wilson_(jazz_singer).png', 'Duke_Ellington.png', 'Jelly_Roll_Morton.png', 'Charlie_Barnet.png', 'Lester_Young.png', 'David_Baker_(composer).png', 'Slam_Stewart.png', 'Kenny_Dorham.png', 'Gerald_Wilson.png', 'Dexter_Gordon.png', 'Snooky_Young.png', 'Charlie_Christian.png', 'Alan_Dawson.png', 'Kenny_Burrell.png', 'Abbey_Lincoln.png', 'Horace_Silver.png', 'Louis_Armstrong.png', 'Melba_Liston.png', 'Jimmy_Cleveland.png', 'Glenn_Miller.png', 'Bing_Crosby.png', 'Wynton_Kelly.png', 'Wardell_Gray.png', 'George_Shearing.png', 'Clifford_Brown.png', 'Ray_Brown_(musician).png', 'Hot_Lips_Page.png', 'Zutty_Singleton.png', 'James_P._Johnson.png', 'Claude_Thornhill.png']; var metaNames = ['Milt_Hinton.meta', 'Frank_Foster_(musician).meta', 'Buddy_Tate_(musician).meta', 'Mary_Lou_Williams.meta', 'Gunther_Schuller.meta', 'Billy_Taylor_(jazz_bassist).meta', 'Gerald_Wiggins.meta', 'Eddie_Marshall.meta', 'Dave_Brubeck.meta', 'J._J._Johnson.meta', 'Yusef_Lateef.meta', 'Melba_Liston.meta', 'Joe_Williams_(jazz_singer).meta', 'Cozy_Cole.meta', 'Charles_Mingus.meta', 'Louie_Bellson.meta', 'Lionel_Hampton.meta', 'Chico_Hamilton.meta', 'Abbey_Lincoln.meta', 'Clark_Terry.meta', 'Roy_Haynes.meta', 'Oscar_Peterson.meta', 'Ray_Drummond.meta', 'Benny_Golson.meta', 'Artie_Shaw.meta', 'Jimmy_Scott.meta', 'Danny_Barker.meta', 'Johnny_Griffin.meta', 'Buster_Williams.meta', 'Etta_Jones.meta', 'Slide_Hampton.meta', 'Roy_Eldridge.meta', 'Buddy_DeFranco.meta'];


        var tripleStore = null;			//holds the triple data bank created by te rdfquery plugin
        var tripleObject = null;		//holds the javascript seralized object of the triple store
        var descStore = null;			//holds the triple data bank created by te rdfquery plugin for the description
        var descObject = null;			//holds the javascript seralized object of the triple store for the description
        var usePerson = null;			//the person in person mode
        var dynamicPeople = [];			//holds who is added in the dynamic mode
        var baseNodes = [];             //stores the base (all) of the nodes and
        var baseLinks = [];				// links
        var connectionCounter = {};		//holds each  id as a property name w/ the value = # of connections they have

        var connectionIndex = {};		//a object with properties as id names, with values an array of strings of ids that person has connections to.
        var largestConnection = 0;		//
        var simlarityIndex = {}			//properties are id names, with the value being an array of objects with other ids and their # of matching connections
        var largestSimilarity = 0;		//holds the max number of similar connections any two nodes share in the network
        var cssSafe = new RegExp(/%|\(|\)|\.|\,/g);	//the regex to remove non css viable chars

        jQuery(document).ready(function ($) {


            //give the UI some breathing room, a chance to render
            setTimeout(function () {

                //grab the descripons of the artists
                $.get('data/abstracts.txt', function (data) {
                    buildDescriptionStore(data);
                });


                $.get('data/triples.txt', function (data) {


                    buildTripleStore(data);

                    buildBase();
                    buildDynamicList();

                })
                .error(function () { alert("There was an error in accessing the data file. Please try again."); });

            }, 200, []);


        });

        //process the triple data through the RDF jquery plugin to create an object
        function buildTripleStore(data) {

            tripleStore = $.rdf.databank([],
              {
                  base: 'http://www.dbpedia.org/',
                  namespaces: {
                      dc: 'http://purl.org/dc/elements/1.1/',
                      foaf: 'http://xmlns.com/foaf/0.1/',
                      lj: 'http://www.linkedjazz.org/lj/'
                  }
              });


            /***********
            * 	The file we are loading is expected to be a triple store in the format '<object> <predicate> <object> .\n'
            *   Note the space after the final object and the '.' and the \n only
            ************/
            var triples = data.split("\n");
            for (x in triples) {
                if (triples[x].length > 0) {
                    try {
                        tripleStore.add(triples[x]);
                    }
                    catch (err) {
                        //if it cannot load one of the triples it is not a total failure, keep going
                        console.log('There was an error processing the data file:');
                        console.log(err);
                    }
                }
            }


            tripleObject = tripleStore.dump()


        }




        //process the triple data through the RDF jquery plugin to create an object
        function buildDescriptionStore(data) {

            var descStore = $.rdf.databank([],
              {
                  base: 'http://www.dbpedia.org/',
                  namespaces: {
                      dc: 'http://purl.org/dc/elements/1.1/',
                      wc: 'http://www.w3.org/2000/01/rdf-schema',
                      lj: 'http://www.linkedjazz.org/lj/'
                  }
              });


            /***********
            * 	The file we are loading is expected to be a triple dump in the format '<object> <predicate> <object> .\n'
            *   Note the space after the final object and the '.' and the \n only
            ************/
            var triples = data.split("\n");
            for (x in triples) {
                if (triples[x].length > 0) {
                    try {
                        descStore.add(triples[x]);
                    }
                    catch (err) {
                        //if it cannot load one of the triples it is not a total failure, keep going
                        console.log('There was an error processing the data file:');
                        console.log(err);
                    }
                }
            }


            descObject = descStore.dump()



        }




        //build the intial list used for dynamic mode
        function buildDynamicList() {


            var listNodes = baseNodes;
           
            listNodes.sort(function (a, b) {
                var nameA = a.labelLast.toLowerCase(), nameB = b.labelLast.toLowerCase()
                if (nameA < nameB) //sort string ascending
                    return -1
                if (nameA > nameB)
                    return 1
                return 0 //default return value (no sorting)
            });

            for (x in listNodes) {
                
                var id_css = listNodes[x].id.split("/")[listNodes[x].id.split("/").length - 1].replace(cssSafe, '');
                var id_img = $.trim(decodeURI(listNodes[x].id).split("\/")[decodeURI(listNodes[x].id).split("\/").length - 1]);

                var descText = '';
                if (descObject.hasOwnProperty(listNodes[x].id)) {
                    var desc = descObject[listNodes[x].id]['http://www.w3.org/2000/01/rdf-schema#comment'][0].value;
                    var r = /\\u([\d\w]{4})/gi;
                    desc = desc.replace(r, function (match, grp) {
                        return String.fromCharCode(parseInt(grp, 16));
                    });
                    desc = unescape(desc);
                    descText = decodeURIComponent(desc);
                    descText = descText.replace(/&ndash;/gi, '-');
                    descText = descText.replace(/&amp;/gi, '&');


                }



                $("#dynamicListHolder").append
                (
                    $("<div>")
                        .attr("id", "dynamic_" + id_css)
                        .addClass("dynamicListItem")
                        .data("label", listNodes[x].labelLast)
                        .data("id", listNodes[x].id)
                        .click(function () { if (dynamicPeople.indexOf($(this).data("id")) == -1) { $("#dynamicClear").fadeIn(5000); $("#dynamicHelp").css("display", "none"); usePerson = $(this).data("id"); dynamicPeople.push(usePerson); filter(); } })
                        .append
                        (
                            $("<img>")
                                .attr("src", function () {

                                    if (fileNames.indexOf(id_img + '.png') != -1) {
                                        return "img/" + id_img + '.png';
                                    } else {
                                        return "";
                                    }
                                })
                                .css("visibility", function () {
                                    if (fileNames.indexOf(id_img + '.png') != -1) {
                                        return "visible"
                                    } else {
                                        return "hidden"
                                    }
                                })

                        )
                        .append
                        (
                            $("<div>")
                                .text(listNodes[x].labelLast)
                                .attr("title", descText)

                        )

                )
            }


        }


        //	Builds the base nodes and links arrays 
        function buildBase() {


            var allObjects = [];
            var quickLookup = {};

            //we need to establish the nodes and links
            //we do it by making a string array and adding their ids to it, if it is unique in the string array then we can add the object to the node array


            for (x in tripleObject) {	//each x here is a person


                if (allObjects.indexOf(String(x)) == -1) {
                    allObjects.push(String(x));
                    baseNodes.push({ id: String(x) });
                }

                for (y in tripleObject[x]) {		//this level is the types of relations, mentions, knows, etc. each y here is a realtion bundle
                    for (z in tripleObject[x][y]) {	//here each z is a relation					
                        if (allObjects.indexOf(tripleObject[x][y][z].value) == -1) {

                            baseNodes.push({ id: tripleObject[x][y][z].value });
                            allObjects.push(tripleObject[x][y][z].value);

                            //we are adding props to this object to store their # of connections, depending on the order they may have already been added if they
                            //were added by the creatLink function, so in both places check for the propery and add it in if it is not yet set

                            if (!connectionCounter.hasOwnProperty(tripleObject[x][y][z].value)) {
                                connectionCounter[tripleObject[x][y][z].value] = 0;
                            }

                            if (!quickLookup.hasOwnProperty(tripleObject[x][y][z].value)) {
                                quickLookup[tripleObject[x][y][z].value] = -1;
                            }

                        }
                        createLink(String(x), tripleObject[x][y][z].value);
                    }
                }
            }


            //asign the number of connections each node has  and add the label	
            for (aNode in baseNodes) {
                baseNodes[aNode].connections = connectionCounter[baseNodes[aNode].id];
                if (baseNodes[aNode].connections > largestConnection) { largestConnection = baseNodes[aNode].connections; }

                //build an human label
                var label = $.trim(decodeURIComponent(baseNodes[aNode].id.split("/")[baseNodes[aNode].id.split("/").length - 1]).replace(/\_/g, ' '));
                if (label.search(/\(/) != -1) {
                    label = label.substring(0, label.indexOf("("));
                }
                label = $.trim(label);
                baseNodes[aNode].label = label;
               

                //build a label lastname first
                label = label.split(" ");

                if (label[label.length - 1].toLowerCase() == 'jr.' || label[label.length - 1].toLowerCase() == 'jr' || label[label.length - 1].toLowerCase() == 'sr.' || label[label.length - 1].toLowerCase() == 'sr') {

                    var lastLabel = label[label.length - 2].replace(',', '') + ' ' + label[label.length - 1] + ',';

                    for (var i = 0; i <= label.length - 2; i++) {

                        lastLabel = lastLabel + ' ' + label[i].replace(',', '');

                    }




                } else {

                    var lastLabel = label[label.length - 1] + ',';
                    for (var i = 0; i <= label.length - 2; i++) {

                        lastLabel = lastLabel + ' ' + label[i].replace(',', '');

                    }



                }

                baseNodes[aNode].labelLast = lastLabel;
            }


            //we are building the similarity index here, basiclly it loops through all of the people and compairs their connections with everyone else
            //people who have similar connections have larger  simlarityIndex = the # of connections	 
            for (var key in connectionIndex) {
                var tmpAry = [];
                if (connectionIndex[key].length > 1) {
                    for (var key2 in connectionIndex) {
                        if (key != key2) {
                            if (connectionIndex[key2].length > 1) {
                                var tmpCount = 0;
                                tmpCount = connectionIndex[key].filter(function (i) { return !(connectionIndex[key2].indexOf(i) == -1); }).length;
                                if (tmpCount > 1) {
                                    tmpAry.push({ name: key2, count: tmpCount })
                                    if (tmpCount > largestSimilarity) { largestSimilarity = tmpCount; }
                                }
                            }
                        }
                    }
                }
                tmpAry.sort(function (a, b) {
                    return b.count - a.count;
                });

                simlarityIndex[key] = {};

                for (x in tmpAry) {
                    simlarityIndex[key][tmpAry[x].name] = tmpAry[x].count;
                }




            }



            function createLink(id1, id2) {
                var obj1 = null, obj2 = null;

                //in an effor to speed this lookup a little is to see if we have indexed the pos of the requested ids already, if so do not loop		
                if (quickLookup[id1] > -1 && quickLookup[id2] > -1) {
                    obj1 = quickLookup[id1];
                    obj2 = quickLookup[id2];
                } else {
                    //not yet in the quicklookup object, it will be added here	
                    for (q in baseNodes) {
                        if (baseNodes[q].id == id1) { obj1 = q; }
                        if (baseNodes[q].id == id2) { obj2 = q; }
                        if (obj1 != null && obj2 != null) {


                            quickLookup[id1] = obj1;
                            quickLookup[id2] = obj2;

                            break;
                        }
                    }

                }

                var customClass = "link_" + id1.split("/")[id1.split("/").length - 1].replace(cssSafe, '');
                customClass = customClass + " link_" + id2.split("/")[id2.split("/").length - 1].replace(cssSafe, '');

                baseLinks.push({ source: baseNodes[obj1], target: baseNodes[obj2], distance: 5, customClass: customClass });

                //+1 the number of conenctions, of it is not yet in the object, add it at 1
                if (!connectionCounter.hasOwnProperty(id1)) {
                    connectionCounter[id1] = 1;
                } else {
                    connectionCounter[id1] = connectionCounter[id1] + 1;
                }
                if (!connectionCounter.hasOwnProperty(id2)) {
                    connectionCounter[id2] = 1;
                } else {
                    connectionCounter[id2] = connectionCounter[id2] + 1;
                }


                //add this relation ship to the connectionIndex object
                //has propery yet?
                if (!connectionIndex.hasOwnProperty(id1)) {
                    connectionIndex[id1] = [];
                }
                if (!connectionIndex.hasOwnProperty(id2)) {
                    connectionIndex[id2] = [];
                }

                //does it have this relationship already?
                if (connectionIndex[id1].indexOf(id2) == -1) {
                    connectionIndex[id1].push(id2);
                }
                if (connectionIndex[id2].indexOf(id1) == -1) {
                    connectionIndex[id2].push(id1);
                }




            }




        }



    </script>

</head>
<body>
    <div id="home-view" data-id="home-view" data-role="view"
        data-layout="main-layout" data-title="Home">
        This is Sparta!
       
    </div>

    <div data-role="layout" id="main-layout" data-id="main-layout">
        <!--<header data-role="header">
            <div data-role="navbar">
                <span data-role="view-title"></span>
            </div>
        </header>-->

        <footer data-role="footer">
            <div data-role="tabstrip">
                <a href="#home-view" data-icon="home">Home</a>
                <a href="views/categories-view.html#categories-view" data-icon="bookmarks">Categories</a>
                <a href="views/places-view.html#places-view" data-icon="info">Places</a>
                <a href="views/artists-view.html#artists-view" data-icon="info">Artists</a>
                <a href="views/graph-view.html#graph-view" data-icon="info">Graph</a>

            </div>
        </footer>
    </div>

    <script id="place-template" type="text/x-kendo-template">
            <div>
                <h2>#: Name #</h2>
                <span>located at: (#:Latitude#,#:Longitude#)</span>
                <div>#: Description#</div>
            </div>
    </script>
</body>
</html>
